\section{决策树}
\subsection{熵}

熵(entropy)表示随机变量不确定性的度量，假设$X$是取有限个值的随机变量，其概率分布为

\begin{equation*}
    P(X = x_i) = p_i,\quad i=1,2,\cdots, n
\end{equation*}

则随机变量$X$的的熵定义为

\begin{equation}
    H(X) = -\sum_{i=1}^np_i\log p_i
\end{equation}

若$p_i=0$，则定义$0\log 0 = 0$。

熵越大，随机变量的不确定越大。

那么容易验证

\begin{equation}
    0 \leq H(X) \leq \log n
\end{equation}

不等式左边容易验证，不等式右边是因为$\log x$是上凸函数，即

\begin{equation*}
    \frac{\partial^2 \log x}{\partial x^2} = -\frac{1}{x^2} \leq 0
\end{equation*}

由函数凸性有

\begin{equation*}
    H(x) = \sum_{i=1}^np_i\log \frac{1}{p_i} \leq \log(\sum_{i=1}^np_i\frac{1}{p_i}) = \log n
\end{equation*}

\subsection{条件熵}

设有随机变量$(X, Y)$，其联合概率分布为

\begin{equation}
    P(X=x_i, Y=y_j) = p_{ij}\quad i=1,2,\cdots,N,\quad j=1,2,\cdots,K
\end{equation}

条件熵(conditional entropy) $H(Y|X)$表示在已知随机变量$X$的条件下随机变量$Y$的不确定性。随机变量$X$给定条件下随机变量$Y$的条件熵$H(Y|X)$定义为$X$给定条件下$Y$的条件概率分布的熵对$X$的数学期望

\begin{equation}
    H(Y|X) = \sum_{i=1}^Np_{i*}H(Y|X=x_i)
\end{equation}

其中$p_{i*} = P(X=x_i),i=1,2,\cdots,N$.

现在证明条件熵一定不高于熵，即

\begin{equation}
    H(Y|X) \leq H(Y)
\end{equation}

下面给出证明。

\begin{proof}
    首先依照定义

    \begin{equation}
        H(Y) = -\sum_{j=1}^Kp_{*j}\log p_{*j} = -\sum_{j=1}^K f(p_{*j})
    \end{equation}

    其中
    \begin{equation*}
        f(x) = x\log x
    \end{equation*}

    同样依照定义可得
    \begin{equation}\label{def_hyx}
        \begin{array}{rcl}
            H(Y|X) & = & -\sum_{i=1}^Np_{i*} \sum_{j=1}^K\frac{p_{ij}}{p_{i*}}\log \frac{p_{ij}}{p_{i*}} \\
                   & = & -\sum_{i=1}^Np_{i*} \sum_{j=1}^Kf(\frac{p_{ij}}{p_{i*}})                        \\
                   & = & -\sum_{i=1}^N\sum_{j=1}^K p_{i*}f(\frac{p_{ij}}{p_{i*}})                        \\
                   & = & -\sum_{j=1}^K\sum_{i=1}^N p_{i*}f(\frac{p_{ij}}{p_{i*}})
        \end{array}
    \end{equation}

    容易证明
    \begin{equation*}
        \frac{\partial^2 f}{\partial x^2} = \frac{1}{x} > 0 \quad \text{for} \quad x > 0
    \end{equation*}

    由函数凸性有
    \begin{equation*}
        \sum_{i=1}^N p_i f(x_i) \geq f(\sum_{i=1}^N p_i x_i)
    \end{equation*}

    两边取负号带入\ref{def_hyx}有
    \begin{equation}
        \begin{array}{rcl}
            H(Y|X) & \leq & -\sum_{j=1}^K\big(f(\sum_{i=1}^N p_{i*} \frac{p_{ij}}{p_{i*}})\big) \\
                   & =    & -\sum_{j=1}^Kf(\sum_{i=1}^Np_{ij})                                  \\
                   & =    & -\sum_{j=1}^Kf(p_{*j})                                              \\
                   & =    & H(Y)
        \end{array}
    \end{equation}

    问题得证。
\end{proof}

\begin{remark}
    若定义

    \begin{equation*}
        f_{ij} = f(\frac{p_{ij}}{p_{i*}}) = \frac{p_{ij}}{p_{i*}} \log \frac{p_{ij}}{p_{i*}}\quad 1 \leq i \leq N,\quad 1 \leq j \leq K
    \end{equation*}

    该问题的本质是下面的矩阵交换顺序求和，然后利用凸函数的不等式性质得到。

    \begin{equation*}
        H(Y|X) = [p_{1*}, p_{2*},\cdots, p_{n*}] \times \left[
            \begin{aligned}
                \sum_{j=1}^K f_{1j} \\
                \sum_{j=1}^K f_{2j} \\
                \vdots              \\
                \sum_{j=1}^K f_{Nj} \\
            \end{aligned}
            \right]
        = [p_{1*}, p_{2*},\cdots, p_{n*}] \times \Bigg\{
        \left[
            \begin{aligned}
                f_{11} & \cdots & \quad f_{1K} \\
                f_{21} & \cdots & \quad f_{2K} \\
                \vdots                         \\
                f_{N1} & \cdots & \quad f_{NK} \\
            \end{aligned}
            \right] \times
        \left[
            \begin{aligned}
                1      \\
                1      \\
                \vdots \\
                1      \\
            \end{aligned}
            \right]
        \Bigg\}
    \end{equation*}

    交换顺序后得到

    \begin{equation*}
        H(Y|X) = \Bigg\{ [p_{1*}, p_{2*},\cdots, p_{n*}] \times
        \left[
            \begin{aligned}
                f_{11} & \cdots & \quad f_{1K} \\
                f_{21} & \cdots & \quad f_{2K} \\
                \vdots                         \\
                f_{N1} & \cdots & \quad f_{NK} \\
            \end{aligned}
            \right] \Bigg\} \times
        \left[
            \begin{aligned}
                1      \\
                1      \\
                \vdots \\
                1      \\
            \end{aligned}
            \right]
    \end{equation*}

    即

    \begin{equation*}
        H(Y|X) = \Big[\sum_{i=1}^Np_{i*}f_{i1}, \sum_{i=1}^Np_{i*}f_{i2}, \cdots, \sum_{i=1}^Np_{i*}f_{iK}\Big] \times
        \left[
            \begin{aligned}
                1      \\
                1      \\
                \vdots \\
                1      \\
            \end{aligned}
            \right]
        = \sum_{j=1}^K\sum_{i=1}^Np_{i*}f_{ij} = \sum_{j=1}^K\sum_{i=1}^Np_{i*}f(\frac{p_{ij}}{p_{i*}})
    \end{equation*}

\end{remark}

\subsection{Gini指数}

分类问题中，假设随机变量$X$有$N$个分类，样本点属于第$i$类的概率为$p_i$，则概率分布的基尼指数定义为

\begin{equation*}
    G(X) = \sum_{i=1}^Np_i(1-p_i)
\end{equation*}

\subsection{条件Gini指数}

类似条件熵，可以定义给定$X$的条件下的$Y$的条件基尼指数

\begin{equation*}
    G(Y|X) = \sum_{i=1}^Np_{i*}\sum_{j=1}^K\frac{p_{ij}}{p_{i*}}(1 - \frac{p_{ij}}{p_{i*}})
\end{equation*}

若定义

\begin{equation*}
    f(x) = x(1 - x)
\end{equation*}

容易证明
\begin{equation*}
    \frac{\partial^2 f}{\partial x^2} = -2 < 0 \quad \text{for} \quad \forall x
\end{equation*}

由函数凸性有
\begin{equation*}
    \sum_{i=1}^N p_i f(x_i) \leq f(\sum_{i=1}^N p_i x_i)
\end{equation*}

因此

\begin{equation*}
    \begin{array}{rcl}
        G(Y|X) & = & \sum_{i=1}^Np_{i*}\sum_{j=1}^Kf(\frac{p_{ij}}{p_{i*}}) \\
               & = & \sum_{i=1}^N\sum_{j=1}^Kp_{i*}f(\frac{p_{ij}}{p_{i*}}) \\
               & = & \sum_{j=1}^K\sum_{i=1}^Np_{i*}f(\frac{p_{ij}}{p_{i*}}) \\
               & \leq & \sum_{j=1}^Kf(\sum_{i=1}^Np_{i*}\frac{p_{ij}}{p_{i*}}) \\
               & = & \sum_{j=1}^Kf(\sum_{i=1}^Np_{ij}) \\
               & = & \sum_{j=1}^Kf(p_{*j}) \\
               & = & G(Y)

    \end{array}
\end{equation*}

\subsection{决策树算法概要}

\subsubsection{CART}
\begin{itemize}
    \item 决策树是二叉树
    \item 如果Y是连续变量(continuous variable), 使用回归树，使用平方误差最小化准则。
    \item 如果Y是分类变量(category variable), 使用分类树，使用基尼指数最小化准则。
\end{itemize}